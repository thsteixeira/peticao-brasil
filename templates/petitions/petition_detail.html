{% extends "base.html" %}

{% block title %}{{ petition.get_meta_title }}{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Petition",
  "name": "{{ petition.title }}",
  "description": "{{ petition.get_meta_description }}",
  "url": "{{ petition.get_canonical_url }}",
  "datePublished": "{{ petition.created_at|date:'c' }}",
  "dateModified": "{{ petition.updated_at|date:'c' }}",
  "author": {
    "@type": "Person",
    "name": "{{ petition.creator.get_full_name }}"
  },
  "numberOfSignatures": {{ petition.signature_count }},
  "targetSignatures": {{ petition.signature_goal }}
}
</script>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- Petition Header -->
    <div class="bg-white rounded-lg shadow-md p-8 mb-6">
        <div class="flex items-start justify-between mb-4">
            <div class="flex-1">
                <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold mb-2" 
                      style="background-color: {{ petition.category.color }}22; color: {{ petition.category.color }}">
                    {{ petition.category.name }}
                </span>
                <h1 class="text-4xl font-bold text-gray-900 mb-2">{{ petition.title }}</h1>
                <div class="flex items-center space-x-4 text-sm text-gray-600">
                    <span>Por {{ petition.creator.get_full_name }}</span>
                    <span>‚Ä¢</span>
                    <span>{{ petition.created_at|date:"d/m/Y" }}</span>
                    <span>‚Ä¢</span>
                    <span>{{ petition.view_count }} visualiza√ß√µes</span>
                </div>
            </div>
            {% if user == petition.creator %}
                <a href="{% url 'petitions:edit' petition.uuid %}" class="text-blue-600 hover:text-blue-800">
                    Editar
                </a>
            {% endif %}
        </div>
        
        <!-- Progress Bar -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-2xl font-bold text-gray-900">
                    {{ petition.signature_count }} assinaturas
                </span>
                <span class="text-gray-600">
                    Meta: {{ petition.signature_goal }}
                </span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-blue-600 h-3 rounded-full transition-all" 
                     style="width: {{ petition.progress_percentage }}%"></div>
            </div>
            <p class="text-sm text-gray-600 mt-1">{{ petition.progress_percentage }}% da meta alcan√ßada</p>
        </div>
        
        <!-- Call to Action -->
        <div class="flex space-x-4">
            {% if petition.pdf_url %}
                <a href="{{ petition.pdf_url }}" 
                   target="_blank"
                   class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold transition-colors text-center">
                    üìÑ Baixar PDF para Assinar
                </a>
            {% else %}
                <button class="flex-1 bg-gray-400 text-white px-6 py-3 rounded-lg cursor-not-allowed font-semibold" disabled>
                    ‚è≥ Gerando PDF...
                </button>
            {% endif %}
            <button class="bg-gray-100 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-200 transition-colors">
                üì§ Compartilhar
            </button>
        </div>
        
        {% if petition.deadline %}
            <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p class="text-sm text-yellow-800">
                    ‚è∞ Prazo: {{ petition.deadline|date:"d/m/Y" }}
                    {% if petition.days_remaining %}
                        ({{ petition.days_remaining }} dias restantes)
                    {% else %}
                        (Encerrado)
                    {% endif %}
                </p>
            </div>
        {% endif %}
    </div>
    
    <!-- Petition Description -->
    <div class="bg-white rounded-lg shadow-md p-8 mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Sobre esta Peti√ß√£o</h2>
        <div class="prose max-w-none text-gray-700">
            {{ petition.description|linebreaks }}
        </div>
    </div>
    
    <!-- How to Sign -->
    {% if petition.pdf_url %}
    <div class="bg-white rounded-lg shadow-md p-8 mb-6">
        <div class="flex items-start justify-between mb-4">
            <h2 class="text-2xl font-bold text-gray-900">Como Assinar esta Peti√ß√£o</h2>
            <a href="{% url 'petitions:how_to_sign' %}" class="text-sm text-blue-600 hover:text-blue-800 font-semibold whitespace-nowrap">
                üìñ Guia completo ‚Üí
            </a>
        </div>
        <div class="space-y-4">
            <div class="flex items-start space-x-3">
                <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">1</span>
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">Baixe o PDF da peti√ß√£o</h3>
                    <p class="text-gray-600 text-sm">Clique no bot√£o acima para baixar o documento PDF oficial desta peti√ß√£o.</p>
                </div>
            </div>
            <div class="flex items-start space-x-3">
                <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">2</span>
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">Assine digitalmente com Gov.br</h3>
                    <p class="text-gray-600 text-sm">Acesse o <a href="https://assinador.iti.br/assinatura/" target="_blank" class="text-blue-600 hover:underline">Assinador Gov.br</a> e assine o PDF com sua conta Gov.br (n√≠vel prata ou ouro).</p>
                </div>
            </div>
            <div class="flex items-start space-x-3">
                <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">3</span>
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">Envie o PDF assinado</h3>
                    <p class="text-gray-600 text-sm">Ap√≥s assinar, retorne aqui e fa√ßa o upload do PDF assinado para valida√ß√£o.</p>
                </div>
            </div>
        </div>
        <div class="bg-blue-50 rounded-lg p-4 mt-4 border border-blue-200">
            <p class="text-sm text-gray-700">
                <strong>üí° Primeira vez assinando digitalmente?</strong> 
                Confira nosso <a href="{% url 'petitions:how_to_sign' %}" class="text-blue-600 hover:underline font-semibold">guia passo a passo com imagens</a> 
                sobre como usar o Assinador Gov.br.
            </p>
        </div>
        <div class="mt-6 flex gap-4">
            <a href="{% url 'signatures:submit' uuid=petition.uuid %}" class="inline-block bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                ‚úçÔ∏è Enviar PDF Assinado
            </a>
            <a href="{% url 'petitions:how_to_sign' %}" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                üìñ Ver Guia Completo
            </a>
        </div>
    </div>
    {% endif %}
    
    <!-- Recent Signatures -->
    {% if recent_signatures %}
        <div class="bg-white rounded-lg shadow-md p-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Assinaturas Recentes</h2>
            <div class="space-y-3">
                {% for signature in recent_signatures %}
                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded">
                        <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-semibold">
                            {{ signature.full_name.0 }}
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-900">{{ signature.display_name }}</p>
                            <p class="text-sm text-gray-600">{{ signature.city }}, {{ signature.state }}</p>
                        </div>
                        <span class="text-sm text-gray-500">{{ signature.verified_at|date:"d/m/Y" }}</span>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
